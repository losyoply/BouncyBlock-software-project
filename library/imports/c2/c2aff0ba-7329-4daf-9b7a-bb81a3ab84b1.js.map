{"version":3,"sources":["assets\\scripts\\lose.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class lose extends cc.Component {\r\n\r\n    @property(cc.AudioClip)\r\n    lose_back_music : cc.AudioClip = null; // @A@\r\n\r\n    private uid: string = null;\r\n    private online: boolean = false;\r\n\r\n    onload(){\r\n        cc.audioEngine.pauseMusic(); // @A@\r\n    }\r\n\r\n    start () {\r\n        firebase.auth().onAuthStateChanged((user) => {\r\n            if (user) this.online = true;\r\n        });\r\n        \r\n        this.uid = cc.sys.localStorage.getItem('uid');\r\n        console.log(this.uid);\r\n        this.playBGM();\r\n        cc.debug.setDisplayStats(false);\r\n        //cc.audioEngine.playMusic(this.bgm, true);\r\n\r\n        var score = parseInt(cc.sys.localStorage.getItem(\"nowscore\"));\r\n        var scene = cc.sys.localStorage.getItem(\"nowscene\");\r\n        var h_score = parseInt(cc.sys.localStorage.getItem(\"highscore\"));\r\n        // console.log(score);\r\n        // console.log(this.uid, scene, h_score);\r\n        // console.log(\"storing data if highscore\");\r\n        // console.log((this.uid != 'local'));\r\n        // console.log((this.uid != 'local'));\r\n        // console.log((score > h_score));\r\n        // console.log((this.uid != 'local') && (scene == 'test') && (score > h_score));\r\n        if((this.uid != 'local') && (scene == 'test') && (score > h_score)) {\r\n            firebase.database().ref('/users/' + this.uid + '/highscore').set(score, ()=> {\r\n                cc.sys.localStorage.setItem(\"highscore\", score);\r\n                cc.find('Canvas/best').active = true;\r\n            });\r\n\r\n        }\r\n        cc.find('score').getComponent(cc.Label).string = score.toString();\r\n\r\n        //callback\r\n        if(this.uid != 'local') {                //  &&&& 原本是online, always false\r\n            firebase.database().ref('/users/' + this.uid + '/coins').set(parseInt(cc.sys.localStorage.getItem(\"coins\")));\r\n            firebase.database().ref('/users/' + this.uid + '/thing/lego').set(parseInt(cc.sys.localStorage.getItem(\"lego\")));\r\n            firebase.database().ref('/users/' + this.uid + '/thing/powerup').set(parseInt(cc.sys.localStorage.getItem(\"powerup\")));\r\n            firebase.database().ref('/users/' + this.uid + '/thing/banana').set(parseInt(cc.sys.localStorage.getItem(\"banana\")));\r\n            firebase.database().ref('/users/' + this.uid + '/thing/mute').set(parseInt(cc.sys.localStorage.getItem(\"mute\")));\r\n            firebase.database().ref('/users/' + this.uid + '/thing/signal').set(parseInt(cc.sys.localStorage.getItem(\"signal\")));\r\n        }\r\n        let menu = new cc.Component.EventHandler();\r\n        menu.target = this.node;\r\n        menu.component = \"lose\";\r\n        menu.handler = \"loadmenu\";\r\n        cc.find(\"Canvas/menu\").getComponent(cc.Button).clickEvents.push(menu);\r\n        \r\n    }\r\n\r\n\r\n    loadmenu() {\r\n        //cc.audioEngine.playEffect(this.press, false);\r\n        cc.audioEngine.pauseMusic();\r\n        cc.director.loadScene(\"menu\");\r\n    }\r\n\r\n    playBGM(){// @A@\r\n        cc.audioEngine.playMusic(this.lose_back_music, false);\r\n    }\r\n}\r\n"]}